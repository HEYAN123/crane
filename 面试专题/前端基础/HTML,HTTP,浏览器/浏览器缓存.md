# 浏览器缓存

- 参考资料：
- <https://mp.weixin.qq.com/s/tPZ2KxPZWGigAHbJliZLQA>
- <https://www.jianshu.com/p/54cc04190252>
- <https://www.jianshu.com/p/768be2733872>
- <https://www.cnblogs.com/ranzige/p/3952837.html>

## 宏观定位浏览器缓存

- 浏览器缓存是web缓存技术其中之一。

### web缓存

- web缓存：这是一种网站性能优化的技术。是指访问web网站时需要的web资源（比如html文件,js,css,图片等等），经过一次请求后被保存下来的资源副本。用于避免重复发出对相同资源的请求，减少带宽消耗，缓解服务器压力，提高用户访问网页的速度。
- web缓存技术有以下几种：
    1. 数据库缓存
    2. 服务器缓存
    3. 浏览器缓存
    4. web应用层缓存

- 这篇文章主要讨论的就是其中的浏览器缓存技术。

### 浏览器缓存工作的位置

- 在一个网站中最基础的动作就是发请求收数据，整个过程如下：

```bash
              发出请求
        -------------------->
浏览器                          服务器
        <--------------------
         处理请求整理出数据返回
```

- 浏览器缓存工作的位置就是在浏览器端。或者拥有缓存时不发送请求而直接访问缓存数据，或者发起请求但是经比对缓存与数据一致那就不需要接收数据而直接利用缓存。

## 浏览器缓存的实现

- 有以下四种实现的方法
  1. Service Worker
  2. Memory Cache
  3. Disk Cache
  4. Push Cache

### 1. Service Worker

- Service Worker是基于web worker的技术。web worker就是js里的多线程概念，主线程可创建work子线程并行执行任务。
- Service Worker利用web worker建立了独立的线程用于缓存工作，它会拦截网页上需要缓存资源网络请求，判断是否有匹配的缓存资源，有的话返回缓存，否则继续放出请求，然后新增缓存
- 生命周期：注册->安装->激活->拦截请求->暂停/废弃
- 我fork了一份官方demo，做了一个简单的注释/注释翻译，可以参考：<https://github.com/HEYAN123/samples/tree/gh-pages/service-worker/basic>

### 2. Memory Cache

- 内存缓存。打开页面时提前加载可能用到的资源，把请求到的资源放到内存上，快速读取。
- 当我们访问一个页面时可以看到很多资源都是从内存中读取到的：

![avatar](../../../static/browser.PNG)

- 启用这种缓存的方法常用如下：

  - 利用img或者object等标签预加载脚本（但不执行），然后动态插入脚本时就会直接从缓存中读取
  - 使用link标签的ref属性让浏览器对脚本的加载做特殊处理：

```html
<link rel="subresource" href="xxx">  预加载当前页面要访问的资源
<link rel="prefetch" href="xxx">  预加载将要访问的资源
<link rel="dns-prefetch" href="xxx">  提前解析dns并缓存域名信息
```

### 3. Disk Cache

- 硬盘缓存。即把我们需要常用的资源存储到本地硬盘上。

### 4. Push Cache

- 推送缓存。是优先级最低的缓存。

## 浏览器缓存的策略

- 该如何好好利用缓存？这时候就应该有一个好的缓存策略来控制浏览器恰到好处地对资源进行缓存，通常浏览器的缓存策略分为两种：
    1. 协商缓存
    2. 强缓存

### 协商缓存

### 强缓存